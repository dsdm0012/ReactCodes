{"ast":null,"code":"/* eslint new-cap:0 */\n'use strict';\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n\n  return to;\n};\n\nvar defaultGetLogger = require('../vendor/loglevel').getLogger;\n\nvar constants = require('./constants');\n\nvar DEFAULT_LOG_LEVEL = constants.DEFAULT_LOG_LEVEL,\n    DEFAULT_LOGGER_NAME = constants.DEFAULT_LOGGER_NAME;\n\nvar E = require('./constants').typeErrors;\n\nvar deprecationWarningsByComponentConstructor;\n\nfunction getDeprecationWarnings(componentConstructor) {\n  deprecationWarningsByComponentConstructor = deprecationWarningsByComponentConstructor || new Map();\n\n  if (deprecationWarningsByComponentConstructor.has(componentConstructor)) {\n    return deprecationWarningsByComponentConstructor.get(componentConstructor);\n  }\n\n  var deprecationWarnings = new Set();\n  deprecationWarningsByComponentConstructor.set(componentConstructor, deprecationWarnings);\n  return deprecationWarnings;\n}\n/**\n * Selectively outputs messages to console based on specified minimum module\n * specific log levels.\n *\n * NOTE: The values in the logLevels object passed to the constructor is changed\n *       by subsequent calls to {@link Log#setLevels}.\n */\n\n\nvar Log =\n/** @class */\nfunction () {\n  /**\n   * Construct a new {@link Log} object.\n   * @param {String} moduleName - Name of the logging module (webrtc/media/signaling)\n   * @param {object} component - Component owning this instance of {@link Log}\n   * @param {LogLevels} logLevels - Logging levels. See {@link LogLevels}\n   * @param {String} loggerName - Name of the logger instance. Used when calling getLogger from loglevel module\n   * @param {Function} [getLogger] - optional method used internally.\n   */\n  function Log(moduleName, component, logLevels, loggerName, getLogger) {\n    if (typeof moduleName !== 'string') {\n      throw E.INVALID_TYPE('moduleName', 'string');\n    }\n\n    if (!component) {\n      throw E.REQUIRED_ARGUMENT('component');\n    }\n\n    if (typeof logLevels !== 'object') {\n      logLevels = {};\n    }\n\n    getLogger = getLogger || defaultGetLogger;\n    validateLogLevels(logLevels);\n    /* istanbul ignore next */\n\n    Object.defineProperties(this, {\n      _component: {\n        value: component\n      },\n      _logLevels: {\n        value: logLevels\n      },\n      _warnings: {\n        value: new Set()\n      },\n      _loggerName: {\n        get: function get() {\n          var name = loggerName && typeof loggerName === 'string' ? loggerName : DEFAULT_LOGGER_NAME;\n\n          if (!this._logLevelsEqual) {\n            name = name + \"-\" + moduleName;\n          }\n\n          return name;\n        }\n      },\n      _logger: {\n        get: function get() {\n          var logger = getLogger(this._loggerName);\n          var level = this._logLevels[moduleName] || DEFAULT_LOG_LEVEL; // There is no 'off' in the logger module. It uses 'silent' instead\n\n          level = level === 'off' ? 'silent' : level;\n          logger.setDefaultLevel(level);\n          return logger;\n        }\n      },\n      _logLevelsEqual: {\n        get: function get() {\n          // True if all levels are the same\n          return new Set(Object.values(this._logLevels)).size === 1;\n        }\n      },\n      logLevel: {\n        get: function get() {\n          return Log.getLevelByName(logLevels[moduleName] || DEFAULT_LOG_LEVEL);\n        }\n      },\n      name: {\n        get: component.toString.bind(component)\n      }\n    });\n  }\n  /**\n   * Get the log level (number) by its name (string)\n   * @param {String} name - Name of the log level\n   * @returns {Number} Requested log level\n   * @throws {TwilioError} INVALID_LOG_LEVEL (32056)\n   * @public\n   */\n\n\n  Log.getLevelByName = function (name) {\n    if (!isNaN(name)) {\n      return parseInt(name, 10);\n    }\n\n    name = name.toUpperCase();\n    validateLogLevel(name);\n    return Log[name];\n  };\n  /**\n   * Create a child {@link Log} instance with this._logLevels\n   * @param moduleName - Name of the logging module\n   * @param component - Component owning this instance of {@link Log}\n   * @returns {Log} this\n   */\n\n\n  Log.prototype.createLog = function (moduleName, component) {\n    var name = this._loggerName; // Grab the original logger name\n\n    if (!this._logLevelsEqual) {\n      name = name.substring(0, name.lastIndexOf('-'));\n    }\n\n    return new Log(moduleName, component, this._logLevels, name);\n  };\n  /**\n   * Set new log levels.\n   * This changes the levels for all its ancestors,\n   * siblings, and children and descendants instances of {@link Log}.\n   * @param {LogLevels} levels - New log levels\n   * @throws {TwilioError} INVALID_ARGUMENT\n   * @returns {Log} this\n   */\n\n\n  Log.prototype.setLevels = function (levels) {\n    validateLogLevels(levels);\n    Object.assign(this._logLevels, levels);\n    return this;\n  };\n  /**\n   * Log a message using the logger method appropriate for the specified logLevel\n   * @param {Number} logLevel - Log level of the message being logged\n   * @param {Array} messages - Message(s) to log\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.log = function (logLevel, messages) {\n    var name = Log._levels[logLevel]; // eslint-disable-next-line no-use-before-define\n\n    if (!name) {\n      throw E.INVALID_VALUE('logLevel', LOG_LEVEL_VALUES);\n    }\n\n    name = name.toLowerCase();\n    var prefix = [new Date().toISOString(), name, this.name];\n    (this._logger[name] || function noop() {}).apply(void 0, __spreadArray([], __read(prefix.concat(messages))));\n    return this;\n  };\n  /**\n   * Log a debug message\n   * @param {...String} messages - Message(s) to pass to the logger\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.debug = function () {\n    return this.log(Log.DEBUG, [].slice.call(arguments));\n  };\n  /**\n   * Log a deprecation warning. Deprecation warnings are logged as warnings and\n   * they are only ever logged once.\n   * @param {String} deprecationWarning - The deprecation warning\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.deprecated = function (deprecationWarning) {\n    var deprecationWarnings = getDeprecationWarnings(this._component.constructor);\n\n    if (deprecationWarnings.has(deprecationWarning)) {\n      return this;\n    }\n\n    deprecationWarnings.add(deprecationWarning);\n    return this.warn(deprecationWarning);\n  };\n  /**\n   * Log an info message\n   * @param {...String} messages - Message(s) to pass to the logger\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.info = function () {\n    return this.log(Log.INFO, [].slice.call(arguments));\n  };\n  /**\n   * Log a warn message\n   * @param {...String} messages - Message(s) to pass to the logger\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.warn = function () {\n    return this.log(Log.WARN, [].slice.call(arguments));\n  };\n  /**\n   * Log a warning once.\n   * @param {String} warning\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.warnOnce = function (warning) {\n    if (this._warnings.has(warning)) {\n      return this;\n    }\n\n    this._warnings.add(warning);\n\n    return this.warn(warning);\n  };\n  /**\n   * Log an error message\n   * @param {...String} messages - Message(s) to pass to the logger\n   * @returns {Log} This instance of {@link Log}\n   * @public\n   */\n\n\n  Log.prototype.error = function () {\n    return this.log(Log.ERROR, [].slice.call(arguments));\n  };\n  /**\n   * Log an error message and throw an exception\n   * @param {TwilioError} error - Error to throw\n   * @param {String} customMessage - Custom message for the error\n   * @public\n   */\n\n\n  Log.prototype.throw = function (error, customMessage) {\n    if (error.clone) {\n      error = error.clone(customMessage);\n    }\n\n    this.log(Log.ERROR, error);\n    throw error;\n  };\n\n  return Log;\n}(); // Singleton Constants\n\n/* eslint key-spacing:0 */\n\n/* istanbul ignore next */\n\n\nObject.defineProperties(Log, {\n  DEBUG: {\n    value: 0\n  },\n  INFO: {\n    value: 1\n  },\n  WARN: {\n    value: 2\n  },\n  ERROR: {\n    value: 3\n  },\n  OFF: {\n    value: 4\n  },\n  _levels: {\n    value: ['DEBUG', 'INFO', 'WARN', 'ERROR', 'OFF']\n  }\n});\nvar LOG_LEVELS_SET = {};\nvar LOG_LEVEL_VALUES = [];\n\nvar LOG_LEVEL_NAMES = Log._levels.map(function (level, i) {\n  LOG_LEVELS_SET[level] = true;\n  LOG_LEVEL_VALUES.push(i);\n  return level;\n});\n\nfunction validateLogLevel(level) {\n  if (!(level in LOG_LEVELS_SET)) {\n    throw E.INVALID_VALUE('level', LOG_LEVEL_NAMES);\n  }\n}\n\nfunction validateLogLevels(levels) {\n  Object.keys(levels).forEach(function (moduleName) {\n    validateLogLevel(levels[moduleName].toUpperCase());\n  });\n}\n\nmodule.exports = Log;","map":null,"metadata":{},"sourceType":"script"}