{"ast":null,"code":"import _regeneratorRuntime from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import AgoraRTC from'agora-rtc-sdk-ng';export default function useAgora(client){var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),localVideoTrack=_useState2[0],setLocalVideoTrack=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),localAudioTrack=_useState4[0],setLocalAudioTrack=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),joinState=_useState6[0],setJoinState=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),remoteUsers=_useState8[0],setRemoteUsers=_useState8[1];function createLocalTracks(_x,_x2){return _createLocalTracks.apply(this,arguments);}function _createLocalTracks(){_createLocalTracks=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(audioConfig,videoConfig){var _yield$AgoraRTC$creat,_yield$AgoraRTC$creat2,microphoneTrack,cameraTrack;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return AgoraRTC.createMicrophoneAndCameraTracks(audioConfig,videoConfig);case 2:_yield$AgoraRTC$creat=_context2.sent;_yield$AgoraRTC$creat2=_slicedToArray(_yield$AgoraRTC$creat,2);microphoneTrack=_yield$AgoraRTC$creat2[0];cameraTrack=_yield$AgoraRTC$creat2[1];setLocalAudioTrack(microphoneTrack);setLocalVideoTrack(cameraTrack);return _context2.abrupt(\"return\",[microphoneTrack,cameraTrack]);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return _createLocalTracks.apply(this,arguments);}function join(_x3,_x4,_x5,_x6){return _join.apply(this,arguments);}function _join(){_join=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(appid,channel,token,uid){var _yield$createLocalTra,_yield$createLocalTra2,microphoneTrack,cameraTrack;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(client){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:_context3.next=4;return createLocalTracks();case 4:_yield$createLocalTra=_context3.sent;_yield$createLocalTra2=_slicedToArray(_yield$createLocalTra,2);microphoneTrack=_yield$createLocalTra2[0];cameraTrack=_yield$createLocalTra2[1];_context3.next=10;return client.join(appid,channel,token||null,uid||null);case 10:_context3.next=12;return client.publish([microphoneTrack,cameraTrack]);case 12:window.client=client;window.videoTrack=cameraTrack;setJoinState(true);case 15:case\"end\":return _context3.stop();}}},_callee3);}));return _join.apply(this,arguments);}function leave(){return _leave.apply(this,arguments);}function _leave(){_leave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(localAudioTrack){localAudioTrack.stop();localAudioTrack.close();}if(localVideoTrack){localVideoTrack.stop();localVideoTrack.close();}setRemoteUsers([]);setJoinState(false);_context4.next=6;return client===null||client===void 0?void 0:client.leave();case 6:case\"end\":return _context4.stop();}}},_callee4);}));return _leave.apply(this,arguments);}useEffect(function(){if(!client)return;setRemoteUsers(client.remoteUsers);var handleUserPublished=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,mediaType){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return client.subscribe(user,mediaType);case 2:// toggle rerender while state of remoteUsers changed.\nsetRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleUserPublished(_x7,_x8){return _ref.apply(this,arguments);};}();var handleUserUnpublished=function handleUserUnpublished(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};var handleUserJoined=function handleUserJoined(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};var handleUserLeft=function handleUserLeft(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};client.on('user-published',handleUserPublished);client.on('user-unpublished',handleUserUnpublished);client.on('user-joined',handleUserJoined);client.on('user-left',handleUserLeft);return function(){client.off('user-published',handleUserPublished);client.off('user-unpublished',handleUserUnpublished);client.off('user-joined',handleUserJoined);client.off('user-left',handleUserLeft);};},[client]);return{localAudioTrack:localAudioTrack,localVideoTrack:localVideoTrack,joinState:joinState,leave:leave,join:join,remoteUsers:remoteUsers};}","map":{"version":3,"sources":["/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/src/VideoPlayer/hooks/useAgora.tsx"],"names":["useState","useEffect","AgoraRTC","useAgora","client","undefined","localVideoTrack","setLocalVideoTrack","localAudioTrack","setLocalAudioTrack","joinState","setJoinState","remoteUsers","setRemoteUsers","createLocalTracks","audioConfig","videoConfig","createMicrophoneAndCameraTracks","microphoneTrack","cameraTrack","join","appid","channel","token","uid","publish","window","videoTrack","leave","stop","close","handleUserPublished","user","mediaType","subscribe","Array","from","handleUserUnpublished","handleUserJoined","handleUserLeft","on","off"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport AgoraRTC, {\n  IAgoraRTCClient, IAgoraRTCRemoteUser, MicrophoneAudioTrackInitConfig, CameraVideoTrackInitConfig, IMicrophoneAudioTrack, ICameraVideoTrack, ILocalVideoTrack, ILocalAudioTrack } from 'agora-rtc-sdk-ng';\n\nexport default function useAgora(client: IAgoraRTCClient | undefined)\n  :\n   {\n      localAudioTrack: ILocalAudioTrack | undefined,\n      localVideoTrack: ILocalVideoTrack | undefined,\n      joinState: boolean,\n      leave: Function,\n      join: Function,\n      remoteUsers: IAgoraRTCRemoteUser[],\n    }\n    {\n  const [localVideoTrack, setLocalVideoTrack] = useState<ILocalVideoTrack | undefined>(undefined);\n  const [localAudioTrack, setLocalAudioTrack] = useState<ILocalAudioTrack | undefined>(undefined);\n\n  const [joinState, setJoinState] = useState(false);\n\n  const [remoteUsers, setRemoteUsers] = useState<IAgoraRTCRemoteUser[]>([]);\n\n  async function createLocalTracks(audioConfig?: MicrophoneAudioTrackInitConfig, videoConfig?: CameraVideoTrackInitConfig)\n  : Promise<[IMicrophoneAudioTrack, ICameraVideoTrack]> {\n    const [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks(audioConfig, videoConfig);\n    setLocalAudioTrack(microphoneTrack);\n    setLocalVideoTrack(cameraTrack);\n    return [microphoneTrack, cameraTrack];\n  }\n\n  async function join(appid: string, channel: string, token?: string, uid?: string | number | null) {\n    if (!client) return;\n    const [microphoneTrack, cameraTrack] = await createLocalTracks();\n    \n    await client.join(appid, channel, token || null, uid || null);\n    await client.publish([microphoneTrack, cameraTrack]);\n\n    (window as any).client = client;\n    (window as any).videoTrack = cameraTrack;\n\n    setJoinState(true);\n  }\n\n  async function leave() {\n    if (localAudioTrack) {\n      localAudioTrack.stop();\n      localAudioTrack.close();\n    }\n    if (localVideoTrack) {\n      localVideoTrack.stop();\n      localVideoTrack.close();\n    }\n    setRemoteUsers([]);\n    setJoinState(false);\n    await client?.leave();\n  }\n\n  useEffect(() => {\n    if (!client) return;\n    setRemoteUsers(client.remoteUsers);\n\n    const handleUserPublished = async (user: IAgoraRTCRemoteUser, mediaType: 'audio' | 'video') => {\n      await client.subscribe(user, mediaType);\n      // toggle rerender while state of remoteUsers changed.\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserUnpublished = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserJoined = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserLeft = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    client.on('user-published', handleUserPublished);\n    client.on('user-unpublished', handleUserUnpublished);\n    client.on('user-joined', handleUserJoined);\n    client.on('user-left', handleUserLeft);\n\n    return () => {\n      client.off('user-published', handleUserPublished);\n      client.off('user-unpublished', handleUserUnpublished);\n      client.off('user-joined', handleUserJoined);\n      client.off('user-left', handleUserLeft);\n    };\n  }, [client]);\n\n  return {\n    localAudioTrack,\n    localVideoTrack,\n    joinState,\n    leave,\n    join,\n    remoteUsers,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}