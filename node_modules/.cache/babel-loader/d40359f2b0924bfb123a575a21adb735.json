{"ast":null,"code":"import axios from 'axios';\nconst baseURL = 'http://127.0.0.1:8000/api/';\nconst axiosInstance = axios.create({\n  baseURL: baseURL,\n  timeout: 5000,\n  headers: {\n    Authorization: localStorage.getItem('access_token') ? 'JWT ' + localStorage.getItem('access_token') : null,\n    'Content-Type': 'application/json',\n    accept: 'application/json'\n  }\n});\naxiosInstance.interceptors.response.use(response => {\n  console.log(\"axios response: .......\", response.status);\n  return response;\n}, async function (error) {\n  const originalRequest = error.config;\n  console.log(\"axios error-------------: \", error);\n  console.log(\"original request: \", originalRequest);\n\n  if (error.response.data.code === 'token_not_valid' && error.response.status === 401 && error.response.statusText === 'Unauthorized') {\n    console.log(\"401 status code hai mere bhai\");\n    const refreshToken = localStorage.getItem('refresh_token');\n\n    if (refreshToken) {\n      const tokenParts = JSON.parse(atob(refreshToken.split('.')[1])); // exp date in token is expressed in seconds, while now() returns milliseconds:\n\n      const now = Math.ceil(Date.now() / 1000);\n      console.log(\"now: \", now);\n      console.log(\"tokenParts.exp: \", tokenParts.exp);\n\n      if (tokenParts.exp > now) {\n        return axiosInstance.post('token/refresh/', {\n          refresh: refreshToken\n        }).then(response => {\n          localStorage.setItem('access_token', response.data.access);\n          localStorage.setItem('refresh_token', response.data.refresh);\n          console.log(\"new access Token: \", response.data.access);\n          console.log(\"new refresh token: \", response.data.refresh);\n          {\n            /*axiosInstance.defaults.headers['Authorization'] =\n                                                                    'JWT ' + response.data.access;*/\n          }\n          originalRequest.headers['Authorization'] = 'JWT ' + response.data.access;\n          return axiosInstance(originalRequest);\n        }).catch(err => {\n          console.log(\"This isthe error original request\", err);\n        });\n      } else {\n        console.log('Refresh token is expired', tokenParts.exp, now);\n        window.location.href = '/login/';\n      }\n    } else {\n      console.log('Refresh token not available.');\n      window.location.href = '/login/';\n    }\n\n    return Promise.reject(error);\n  }\n\n  return Promise.reject(error);\n});\n{\n  /*\n  \n  axiosInstance.interceptors.response.use(\n  (response) => {\n  \treturn response;\n  },\n  async function (error) {\n  \tconst originalRequest = error.config;\n  \t\tif (typeof error.response === 'undefined') {\n  \t\talert(\n  \t\t\t'A server/network error occurred. ' +\n  \t\t\t\t'Looks like CORS might be the problem. ' +\n  \t\t\t\t'Sorry about this - we will get it fixed shortly.'\n  \t\t);\n  \t\treturn Promise.reject(error);\n  \t}\n  \t\tif (\n  \t\terror.response.status === 401 &&\n  \t\toriginalRequest.url === baseURL + 'token/refresh/'\n  \t) {\n  \t\twindow.location.href = '/login/';\n  \t\treturn Promise.reject(error);\n  \t}\n  \t\tif (\n  \t\terror.response.data.code === 'token_not_valid' &&\n  \t\terror.response.status === 401 &&\n  \t\terror.response.statusText === 'Unauthorized'\n  \t) {\n  \t\tconst refreshToken = localStorage.getItem('refresh_token');\n  \t\t\tif (refreshToken) {\n  \t\t\tconst tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n  \t\t\t\t// exp date in token is expressed in seconds, while now() returns milliseconds:\n  \t\t\tconst now = Math.ceil(Date.now() / 1000);\n  \t\t\tconsole.log(\"now: \", now);\n  \t\t\tconsole.log(\"tokenParts.exp: \",tokenParts.exp);\n  \t\t\t\tif (tokenParts.exp > now) {\n  \t\t\t\treturn axiosInstance\n  \t\t\t\t\t.post('token/refresh/', { refresh: refreshToken })\n  \t\t\t\t\t.then((response) => {\n  \t\t\t\t\t\tlocalStorage.setItem('access_token', response.data.access);\n  \t\t\t\t\t\tlocalStorage.setItem('refresh_token', response.data.refresh);\n  \t\t\t\t\t\t\taxiosInstance.defaults.headers['Authorization'] =\n  \t\t\t\t\t\t\t'JWT ' + response.data.access;\n  \t\t\t\t\t\toriginalRequest.headers['Authorization'] =\n  \t\t\t\t\t\t\t'JWT ' + response.data.access;\n  \t\t\t\t\t\t\treturn axiosInstance(originalRequest);\n  \t\t\t\t\t})\n  \t\t\t\t\t.catch((err) => {\n  \t\t\t\t\t\tconsole.log(err);\n  \t\t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tconsole.log('Refresh token is expired', tokenParts.exp, now);\n  \t\t\t\twindow.location.href = '/login/';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tconsole.log('Refresh token not available.');\n  \t\t\twindow.location.href = '/login/';\n  \t\t}\n  \t}\n  \t\t// specific error handling done elsewhere\n  \treturn Promise.reject(error);\n  }\n  );\n  */\n}\nexport default axiosInstance;","map":{"version":3,"sources":["/home/bibhu/Dropbox/myprojectdir_Django_DRF_React/edrUIreact/edrfront/src/axios.js"],"names":["axios","baseURL","axiosInstance","create","timeout","headers","Authorization","localStorage","getItem","accept","interceptors","response","use","console","log","status","error","originalRequest","config","data","code","statusText","refreshToken","tokenParts","JSON","parse","atob","split","now","Math","ceil","Date","exp","post","refresh","then","setItem","access","catch","err","window","location","href","Promise","reject"],"mappings":"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","sourcesContent":["import axios from 'axios';\n\nconst baseURL = 'http://127.0.0.1:8000/api/';\n\n\nconst axiosInstance = axios.create({\n\tbaseURL: baseURL,\n\ttimeout: 5000,\n\theaders: {\n\t\tAuthorization: localStorage.getItem('access_token')\n\t\t\t? 'JWT ' + localStorage.getItem('access_token')\n\t\t\t: null,\n\t\t'Content-Type': 'application/json',\n\t\taccept: 'application/json',\n\t}, \n});\n\n\n\n\naxiosInstance.interceptors.response.use(\n\t(response)=>{\n\n          console.log(\"axios response: .......\",response.status);\n          return response;\t\n\n    },\n\n     async function (error) {\n       const originalRequest = error.config;\n       console.log(\"axios error-------------: \", error);\n       console.log(\"original request: \", originalRequest);\t     \n\n\n\n\n\n\n          if(  error.response.data.code === 'token_not_valid' &&\n               error.response.status === 401 &&\n               error.response.statusText === 'Unauthorized'\n\t  ){\n\n              console.log(\"401 status code hai mere bhai\");\n              const refreshToken = localStorage.getItem('refresh_token');\n              if (refreshToken ){\n\n                         const tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n\n                                // exp date in token is expressed in seconds, while now() returns milliseconds:\n                         const now = Math.ceil(Date.now() / 1000);\n                         console.log(\"now: \", now);\n                         console.log(\"tokenParts.exp: \",tokenParts.exp);\n                         if (tokenParts.exp > now) {\n\n                          return axiosInstance.post('token/refresh/', { refresh: refreshToken })\n                                                .then((response) => {\n                                                        localStorage.setItem('access_token', response.data.access);\n                                                        localStorage.setItem('refresh_token', response.data.refresh);\n                                                         \n\t\t\t\t\t\t\tconsole.log(\"new access Token: \", response.data.access);\n\t\t\t\t\t\t\tconsole.log(\"new refresh token: \", response.data.refresh);\n\t\t\t\t\t\t\t{/*axiosInstance.defaults.headers['Authorization'] =\n                                                                'JWT ' + response.data.access;*/}\n                                                        originalRequest.headers['Authorization'] =\n                                                                'JWT ' + response.data.access;\n\n                                                        return axiosInstance(originalRequest);\n                                                })\n                                                .catch((err) => {\n                                                        console.log(\"This isthe error original request\",err);\n                                                });\n\n\n\n\n\n\n\t\t\t }else{\n\n                            console.log('Refresh token is expired', tokenParts.exp, now);\n                            window.location.href = '/login/';\n\n\t\t\t }\n\n\n\n\t      }else {\n                    console.log('Refresh token not available.');\n                    window.location.href = '/login/';\n              }\n\n\n\n\n\t      return Promise.reject(error);\t  \n\n          }\n\n\n\n       return Promise.reject(error);\n     }\n\n\n\n);\n\n\n\n\n{/*\n\n\n\naxiosInstance.interceptors.response.use(\n\t(response) => {\n\t\treturn response;\n\t},\n\tasync function (error) {\n\t\tconst originalRequest = error.config;\n\n\t\tif (typeof error.response === 'undefined') {\n\t\t\talert(\n\t\t\t\t'A server/network error occurred. ' +\n\t\t\t\t\t'Looks like CORS might be the problem. ' +\n\t\t\t\t\t'Sorry about this - we will get it fixed shortly.'\n\t\t\t);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tif (\n\t\t\terror.response.status === 401 &&\n\t\t\toriginalRequest.url === baseURL + 'token/refresh/'\n\t\t) {\n\t\t\twindow.location.href = '/login/';\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tif (\n\t\t\terror.response.data.code === 'token_not_valid' &&\n\t\t\terror.response.status === 401 &&\n\t\t\terror.response.statusText === 'Unauthorized'\n\t\t) {\n\t\t\tconst refreshToken = localStorage.getItem('refresh_token');\n\n\t\t\tif (refreshToken) {\n\t\t\t\tconst tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n\n\t\t\t\t// exp date in token is expressed in seconds, while now() returns milliseconds:\n\t\t\t\tconst now = Math.ceil(Date.now() / 1000);\n\t\t\t\tconsole.log(\"now: \", now);\n\t\t\t\tconsole.log(\"tokenParts.exp: \",tokenParts.exp);\n\n\t\t\t\tif (tokenParts.exp > now) {\n\t\t\t\t\treturn axiosInstance\n\t\t\t\t\t\t.post('token/refresh/', { refresh: refreshToken })\n\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\tlocalStorage.setItem('access_token', response.data.access);\n\t\t\t\t\t\t\tlocalStorage.setItem('refresh_token', response.data.refresh);\n\n\t\t\t\t\t\t\taxiosInstance.defaults.headers['Authorization'] =\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\n\t\t\t\t\t\t\toriginalRequest.headers['Authorization'] =\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\n\n\t\t\t\t\t\t\treturn axiosInstance(originalRequest);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Refresh token is expired', tokenParts.exp, now);\n\t\t\t\t\twindow.location.href = '/login/';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Refresh token not available.');\n\t\t\t\twindow.location.href = '/login/';\n\t\t\t}\n\t\t}\n\n\t\t// specific error handling done elsewhere\n\t\treturn Promise.reject(error);\n\t}\n);\n*/}\n\nexport default  axiosInstance;\n"]},"metadata":{},"sourceType":"module"}