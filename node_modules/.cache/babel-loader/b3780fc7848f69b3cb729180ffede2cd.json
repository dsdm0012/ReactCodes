{"ast":null,"code":"import _regeneratorRuntime from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import AgoraRTC from'agora-rtc-sdk-ng';export default function useAgora(client){var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),localVideoTrack=_useState2[0],setLocalVideoTrack=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),localAudioTrack=_useState4[0],setLocalAudioTrack=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),joinState=_useState6[0],setJoinState=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),remoteUsers=_useState8[0],setRemoteUsers=_useState8[1];function createLocalTracks(_x,_x2){return _createLocalTracks.apply(this,arguments);}function _createLocalTracks(){_createLocalTracks=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(audioConfig,videoConfig){var _yield$AgoraRTC$creat,_yield$AgoraRTC$creat2,microphoneTrack,cameraTrack;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return AgoraRTC.createMicrophoneAndCameraTracks(audioConfig,videoConfig);case 2:_yield$AgoraRTC$creat=_context2.sent;_yield$AgoraRTC$creat2=_slicedToArray(_yield$AgoraRTC$creat,2);microphoneTrack=_yield$AgoraRTC$creat2[0];cameraTrack=_yield$AgoraRTC$creat2[1];setLocalAudioTrack(microphoneTrack);setLocalVideoTrack(cameraTrack);return _context2.abrupt(\"return\",[microphoneTrack,cameraTrack]);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return _createLocalTracks.apply(this,arguments);}function join(_x3,_x4,_x5,_x6){return _join.apply(this,arguments);}function _join(){_join=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(appid,channel,token,uid){var _yield$createLocalTra,_yield$createLocalTra2,microphoneTrack,cameraTrack;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(client){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:_context3.next=4;return createLocalTracks();case 4:_yield$createLocalTra=_context3.sent;_yield$createLocalTra2=_slicedToArray(_yield$createLocalTra,2);microphoneTrack=_yield$createLocalTra2[0];cameraTrack=_yield$createLocalTra2[1];_context3.next=10;return client.join(appid,channel,token||null,uid||null);case 10:_context3.next=12;return client.publish([microphoneTrack,cameraTrack]);case 12:window.client=client;window.videoTrack=cameraTrack;setJoinState(true);case 15:case\"end\":return _context3.stop();}}},_callee3);}));return _join.apply(this,arguments);}function leave(){return _leave.apply(this,arguments);}function _leave(){_leave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(localAudioTrack){localAudioTrack.stop();localAudioTrack.close();}if(localVideoTrack){localVideoTrack.stop();localVideoTrack.close();}setRemoteUsers([]);setJoinState(false);_context4.next=6;return client===null||client===void 0?void 0:client.leave();case 6:case\"end\":return _context4.stop();}}},_callee4);}));return _leave.apply(this,arguments);}useEffect(function(){if(!client)return;setRemoteUsers(client.remoteUsers);var handleUserPublished=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,mediaType){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return client.subscribe(user,mediaType);case 2:// toggle rerender while state of remoteUsers changed.\nsetRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleUserPublished(_x7,_x8){return _ref.apply(this,arguments);};}();var handleUserUnpublished=function handleUserUnpublished(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};var handleUserJoined=function handleUserJoined(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};var handleUserLeft=function handleUserLeft(user){setRemoteUsers(function(remoteUsers){return Array.from(client.remoteUsers);});};client.on('user-published',handleUserPublished);client.on('user-unpublished',handleUserUnpublished);client.on('user-joined',handleUserJoined);client.on('user-left',handleUserLeft);return function(){client.off('user-published',handleUserPublished);client.off('user-unpublished',handleUserUnpublished);client.off('user-joined',handleUserJoined);client.off('user-left',handleUserLeft);};},[client]);return{localAudioTrack:localAudioTrack,localVideoTrack:localVideoTrack,joinState:joinState,leave:leave,join:join,remoteUsers:remoteUsers};}","map":null,"metadata":{},"sourceType":"module"}