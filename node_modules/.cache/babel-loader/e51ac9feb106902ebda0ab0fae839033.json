{"ast":null,"code":"import axios from 'axios';\nimport basewebURL from \"./basewebURL\";\nconst baseURL = basewebURL + '/api/';\nconst axiosInstance = axios.create({\n  baseURL: baseURL,\n  timeout: 5000,\n  headers: {\n    Authorization: localStorage.getItem('access_token') ? 'JWT ' + localStorage.getItem('access_token') : null,\n    'Content-Type': 'application/json',\n    accept: 'application/json'\n  }\n});\n{\n  /*\n  \n  axiosInstance.interceptors.response.use(\n  (response) => {\n  \treturn response;\n  },\n  async function (error) {\n  \tconst originalRequest = error.config;\n  \t\tif (typeof error.response === 'undefined') {\n  \t\talert(\n  \t\t\t'A server/network error occurred. ' +\n  \t\t\t\t'Looks like CORS might be the problem. ' +\n  \t\t\t\t'Sorry about this - we will get it fixed shortly.'\n  \t\t);\n  \t\treturn Promise.reject(error);\n  \t}\n  \t\tif (\n  \t\terror.response.status === 401 &&\n  \t\toriginalRequest.url === baseURL + 'token/refresh/'\n  \t) {\n  \t\twindow.location.href = '/login/';\n  \t\treturn Promise.reject(error);\n  \t}\n  \t\tif (\n  \t\terror.response.data.code === 'token_not_valid' &&\n  \t\terror.response.status === 401 &&\n  \t\terror.response.statusText === 'Unauthorized'\n  \t) {\n  \t\tconst refreshToken = localStorage.getItem('refresh_token');\n  \t\t\tif (refreshToken) {\n  \t\t\tconst tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n  \t\t\t\t// exp date in token is expressed in seconds, while now() returns milliseconds:\n  \t\t\tconst now = Math.ceil(Date.now() / 1000);\n  \t\t\tconsole.log(\"now: \", now);\n  \t\t\tconsole.log(\"tokenParts.exp: \",tokenParts.exp);\n  \t\t\t\tif (tokenParts.exp > now) {\n  \t\t\t\treturn axiosInstance\n  \t\t\t\t\t.post('token/refresh/', { refresh: refreshToken })\n  \t\t\t\t\t.then((response) => {\n  \t\t\t\t\t\tlocalStorage.setItem('access_token', response.data.access);\n  \t\t\t\t\t\tlocalStorage.setItem('refresh_token', response.data.refresh);\n  \t\t\t\t\t\t\taxiosInstance.defaults.headers['Authorization'] =\n  \t\t\t\t\t\t\t'JWT ' + response.data.access;\n  \t\t\t\t\t\toriginalRequest.headers['Authorization'] =\n  \t\t\t\t\t\t\t'JWT ' + response.data.access;\n  \t\t\t\t\t\t\treturn axiosInstance(originalRequest);\n  \t\t\t\t\t})\n  \t\t\t\t\t.catch((err) => {\n  \t\t\t\t\t\tconsole.log(err);\n  \t\t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tconsole.log('Refresh token is expired', tokenParts.exp, now);\n  \t\t\t\twindow.location.href = '/login/';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tconsole.log('Refresh token not available.');\n  \t\t\twindow.location.href = '/login/';\n  \t\t}\n  \t}\n  \t\t// specific error handling done elsewhere\n  \treturn Promise.reject(error);\n  }\n  );\n  */\n}\nexport default axiosInstance;","map":{"version":3,"sources":["/home/bibhu/EDRdevelopment/DevBranch/edresearchweb/src/axios.js"],"names":["axios","basewebURL","baseURL","axiosInstance","create","timeout","headers","Authorization","localStorage","getItem","accept"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AAEA,MAAMC,OAAO,GAAGD,UAAU,GAAC,OAA3B;AAGA,MAAME,aAAa,GAAGH,KAAK,CAACI,MAAN,CAAa;AAClCF,EAAAA,OAAO,EAAEA,OADyB;AAElCG,EAAAA,OAAO,EAAE,IAFyB;AAGlCC,EAAAA,OAAO,EAAE;AACRC,IAAAA,aAAa,EAAEC,YAAY,CAACC,OAAb,CAAqB,cAArB,IACZ,SAASD,YAAY,CAACC,OAAb,CAAqB,cAArB,CADG,GAEZ,IAHK;AAIR,oBAAgB,kBAJR;AAKRC,IAAAA,MAAM,EAAE;AALA;AAHyB,CAAb,CAAtB;AAeA;AAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWG;AAEH,eAAgBP,aAAhB","sourcesContent":["import axios from 'axios';\nimport basewebURL from \"./basewebURL\";\n\nconst baseURL = basewebURL+'/api/';\n\n\nconst axiosInstance = axios.create({\n\tbaseURL: baseURL,\n\ttimeout: 5000,\n\theaders: {\n\t\tAuthorization: localStorage.getItem('access_token')\n\t\t\t? 'JWT ' + localStorage.getItem('access_token')\n\t\t\t: null,\n\t\t'Content-Type': 'application/json',\n\t\taccept: 'application/json',\n\t}, \n});\n\n\n\n\n{/*\n\n\n\naxiosInstance.interceptors.response.use(\n\t(response) => {\n\t\treturn response;\n\t},\n\tasync function (error) {\n\t\tconst originalRequest = error.config;\n\n\t\tif (typeof error.response === 'undefined') {\n\t\t\talert(\n\t\t\t\t'A server/network error occurred. ' +\n\t\t\t\t\t'Looks like CORS might be the problem. ' +\n\t\t\t\t\t'Sorry about this - we will get it fixed shortly.'\n\t\t\t);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tif (\n\t\t\terror.response.status === 401 &&\n\t\t\toriginalRequest.url === baseURL + 'token/refresh/'\n\t\t) {\n\t\t\twindow.location.href = '/login/';\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tif (\n\t\t\terror.response.data.code === 'token_not_valid' &&\n\t\t\terror.response.status === 401 &&\n\t\t\terror.response.statusText === 'Unauthorized'\n\t\t) {\n\t\t\tconst refreshToken = localStorage.getItem('refresh_token');\n\n\t\t\tif (refreshToken) {\n\t\t\t\tconst tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n\n\t\t\t\t// exp date in token is expressed in seconds, while now() returns milliseconds:\n\t\t\t\tconst now = Math.ceil(Date.now() / 1000);\n\t\t\t\tconsole.log(\"now: \", now);\n\t\t\t\tconsole.log(\"tokenParts.exp: \",tokenParts.exp);\n\n\t\t\t\tif (tokenParts.exp > now) {\n\t\t\t\t\treturn axiosInstance\n\t\t\t\t\t\t.post('token/refresh/', { refresh: refreshToken })\n\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\tlocalStorage.setItem('access_token', response.data.access);\n\t\t\t\t\t\t\tlocalStorage.setItem('refresh_token', response.data.refresh);\n\n\t\t\t\t\t\t\taxiosInstance.defaults.headers['Authorization'] =\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\n\t\t\t\t\t\t\toriginalRequest.headers['Authorization'] =\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\n\n\t\t\t\t\t\t\treturn axiosInstance(originalRequest);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Refresh token is expired', tokenParts.exp, now);\n\t\t\t\t\twindow.location.href = '/login/';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Refresh token not available.');\n\t\t\t\twindow.location.href = '/login/';\n\t\t\t}\n\t\t}\n\n\t\t// specific error handling done elsewhere\n\t\treturn Promise.reject(error);\n\t}\n);\n*/}\n\nexport default  axiosInstance;\n"]},"metadata":{},"sourceType":"module"}